var p=Object.create;var l=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var c=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,o=Object.prototype.hasOwnProperty;var T=(i,e)=>{for(var t in e)l(i,t,{get:e[t],enumerable:!0})},r=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of c(e))!o.call(i,s)&&s!==t&&l(i,s,{get:()=>e[s],enumerable:!(n=h(e,s))||n.enumerable});return i};var f=(i,e,t)=>(t=i!=null?p(u(i)):{},r(e||!i||!i.__esModule?l(t,"default",{value:i,enumerable:!0}):t,i)),m=i=>r(l({},"__esModule",{value:!0}),i);var F={};T(F,{CRUDService:()=>a,createClient:()=>d.createClient});module.exports=m(F);var y=f(require("edgedb"),1),d=require("edgedb"),a=class{constructor(e){this.config=e;this.create=async e=>await this.client.transaction(async t=>{let{id:n}=await this.e.insert(this.eType,e).run(t);return await this.e.select(this.eType,()=>({...this.eFields,filter_single:{id:n}})).run(t)});this.updateById=async(e,t)=>await this.e.update(this.eType,()=>({set:t,filter_single:{id:e}})).run(this.client);this.findAll=async()=>await this.e.select(this.eType,()=>({...this.eFields})).run(this.client);this.findById=async e=>await this.e.select(this.eType,()=>({...this.eFields,filter_single:{id:e}})).run(this.client);this.deleteById=async e=>await this.e.delete(this.eType,()=>({filter_single:{id:e}})).run(this.client);this.findByField=async(e,t)=>await this.e.select(this.eType,s=>({...this.eFields,filter_single:this.e.op(s[e],"=",this.e.uuid(t))})).run(this.client);this.findAllByField=async(e,t)=>await this.e.select(this.eType,s=>({...this.eFields,filter:this.e.op(s[e],"=",this.e.uuid(t))})).run(this.client);this.findByFields=async e=>await this.e.select(this.eType,()=>({...this.eFields,filter_single:e})).run(this.client);e.client&&("options"in e.client||(this.client=(0,y.default)(e.client)),this.client=this.client.withConfig({session_idle_transaction_timeout:y.Duration.from({seconds:10}),allow_bare_ddl:"AlwaysAllow"}).withRetryOptions({attempts:3,backoff:t=>2**t*100+Math.random()*100})),this.e=this.config.edgedb,this.typeName=this.config.type,this.eType=this.e[this.typeName],this.eFields=this.eType["*"]}};0&&(module.exports={CRUDService,createClient});
//# sourceMappingURL=index.cjs.map